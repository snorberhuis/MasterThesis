\chapter{Related Work}
In this chapter we will discuss related work on tamper-proof interaction histories.

\section{Bitcoin}
Bitcoin is a digital currency that uses a interaction history 
to keep track of transactions made between nodes.
The interaction history is a datastructure called the block chain.

The block chain imposes limits on Bitcoin in several ways.
These limitations on Bitcoin can be seen as the initial motivation for our work.
How Bitcoin uses the block chain technology will be introduced first.
In the following, the limitations imposed by the block chain will be explained.

We will only introduce how Bitcoins uses the block chain and why it does so in such a way.
This section is not a full explanation of the Bitcoin protocol
and only discusses relevant parts of the Bitcoin protocol.
The best starting point for a full explanation of Bitcoins 
is the original paper by Nakamoto\cite{Nakamoto-bitcoin}.
Further information and improvements on Bitcoin can be found on the Bitcoin website\cite{Bitcoin.org-site}.

\subsection{Block Chain}
For a currency to work, people have to be able to trust with a reasonable certainty that no double spending can occur.
Double spending With physical tokens is impossible,
but the same guarantee is not trivial for digital currencies without a trusted third party.
Bitcoin has multiple safe gaurds that work together to prevent double spending.
These safe gaurds will be introduced during the explanation of how Bitcoin works.

The core of the Bitcoin protocol is the block chain.
The block chain contains every transaction of bitcoins.
A transaction consists of three parts.
The first part is the public key the new owner of the bitcoin.
The hash of the whole, previous transaction and the public key of the new owner is concatenated.
This concatenation is hashed and this hash is the second part of the transaction.
The third final part is signature by the current owner of the hash of the concatenation.
The previous transaction is a transaction of the same bitcoin.
The ownership of the bitcoin by the current owner can be verified
by verifying the whole history of the bitcoin.
A transaction is usually shortend to Tx in Bitcoin related work and is used in images in this report.

\begin{figure}[H]
	\centerline{\includegraphics[scale=0.3]{relatedWork/figs/transactions.eps}}
	\caption{Transaction chain}
\end{figure}

Multiple transactions are aggregrated into a single block.
Every block contains the hash of the previous block.
This creates the block chain.
Transaction chains across span several blocks inside the block chain.

These blocks are created by nodes in the network, so called miners.
A miner receives transactions from other nodes in the Bitcoin network.
An attacker can malicously transmit transactions to double spend a bitcoin he owns or does not have.
So every transaction is verified on arrival at a node.
Any transaction that is invalid is just dropped by the node.
No penalty is awarded to the malicous attacker.

The transactions are received in a non deterministic way induced by network characteristics.
The non deterministic nature causes blocks to differ from miner to miner.
The order of transactions has to be agreed upon by the network to eliminate this inconsistency.

Bitcoin uses election to pick the next block  based upon a Proof-Of-Work system.
A nonce is added to every block. 
This nonce is just a number that can be varied,
but is only sound if the hash of the whole block starts with a certain number of zeros.
Miners have to find the correct nonce for their block and this is a proof of work.

\begin{figure}[H]
        \centerline{\includegraphics[scale=0.3]{relatedWork/figs/blocks.eps}}
        \caption{Block chain}
\end{figure}

But miners can still find a valid nonce at approximately the same time
and notify parts of the network of their newly found block.
This leaves the network again in an inconsisted state.
These multiple versions of the next block attached to the previous block can be seen as branches.

To solve this inconsistency, Bitcoin nodes save both branches and continue using the longest branch.
At some point one branch will become predominant in the network.
More nodes will dedicate compute power to extend this branch and the growth rate will increase for this branch.
The faster growth rate will ensure that the branch will be adopted by the network as a whole.

The amount of zeros needed in the hash is adjusted to compensate for the fluctuating speed of the network to be able to find nonces.
This is called the hash speed and is the amount of hashes calculated per second.
The hash speed of the Bitcoin network has increased nine fold.
The amount of zeros balances the probability of branches occuring
and the time before a new block is found,
which in turn is how fast transactions are processed.
The growth of the hash speed can be seen in \ref{fig:hash-speed}.

\begin{figure}[H]
        \centerline{\includegraphics[scale=0.6]{relatedWork/figs/hashspeed/hashspeed.eps}}
        \caption{Amount of hashes calculated per second in the Bitcoin network.\cite{Blockchain.info-bcs}}
	\label{fig:hash-speed}
\end{figure}

Another possible attack to double spend a bitcoin is by sending a transaction to one part of the network,
but to the other part of the network a transaction with a different receipient.
It is possible that both transactions will be introduced into the block chain, but in different branches by two independend miners.
Eventually one branch will win and the attack is averted.

The behaviour just described makes that a transaction can never be confirmed with full certainty.
Another branch could possibly always over take the current longest branch.
This also makes the network vulnerable if the total compute power is owned by a malicous attacker is more than the total compute power of the honest nodes, 
even if the attack has control of 51\% of the compute power. 
In the end the current branch can be overtaken by a new branch started by the attacker.
This new branch allows the whole transaction history to be rewritten by the attacker.
Bitcoin introduces points in the chain that are to be considered final and can no longer change.

\subsection{Limitations}
In this section we will discuss the several limitations of Bitcoins
that originate from the use of the block chain.

\subsubsection{Size}
To be able to prevent double spending and rightfull spending by the right owner, 
the node verifying a transaction needs to be aware of the full history of a bitcoin.
This results in that a node needs the entire block chain to verify a transaction.

The block chain is a data structure ever increasing in size.
No block or data contained in that block is removed.
The block chain has been growing since its inception in 2009.
The size and growth can be seen in figure \ref{fig:bc-size}.

\begin{figure}[H]
        \centerline{\includegraphics[scale=0.6]{relatedWork/figs/blockchainsize/blockchainsize.eps}}
        \caption{The size of the block chain.\cite{Blockchain.info-bcs}}
	\label{fig:bc-size}
\end{figure}

The size of the block chain at time of writing already prevents less powerfull devices
to operate on the block chain.
This problem is only going to become bigger with the continued creation of transactions
and at a faster pace due to increased adoption of Bitcoin.

This problem was already identified by Nakamoto in his original paper on Bitcoin.
The paper proposes Simplified Payment Verification (SPV).
In SPV mode a node only downloads the block headers of the longest chain.
If a transaction is to be verified, it requests from the network the specific transaction
along with a Merkle tree linking it to a block in the chain.
The Merkle tree can be used to verify that the transaction was included into the block chain.
This allows to calculate with some confidence that the transaction was accepted.

SVP only gives reasonable confidence and is not as secure as running a full node.
Trust has to be placed in the nodes that send the block headers and Merkle Trees.
Secondly, a transaction that is recorded in a more recent block is less difficult to tamper with
than a transaction deep down in the block chain.
This is only an acceptable solution for clients willing to accept more risk due to having a less secure system.
Therefor it is not a solution for the problem for every one.

